const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BoVrSYUP.js","assets/index-My90LZL7.js","assets/index-C2gQaTHI.js","assets/index-WDw03FXS.css","assets/hashTypedData-Jc26q6lB.js","assets/index-DA3ElXG0.js"])))=>i.map(i=>d[i]);
import{z as b,D as l,F as _,G as A,H as m,I as y,_ as C,P as v,J as D}from "./index-C2gQaTHI.js";import{K as k}from "./index-C2gQaTHI.js";function q(h={}){let p,o,c,a;return b(i=>({id:"baseAccount",name:"Base Account",rdns:"app.base.account",type:"baseAccount",async connect({chainId:e,withCapabilities:t,...r}={}){try{const n=await this.getProvider(),s=e??i.chains[0]?.id;if(!s)throw new A;let{accounts:u,currentChainId:f}=await(async()=>{if(r.isReconnecting)return{accounts:(await n.request({method:"eth_accounts",params:[]})).map(d=>({address:l(d)})),currentChainId:await this.getChainId()};const w=await n.request({method:"wallet_connect",params:[{capabilities:"capabilities"in r&&r.capabilities?r.capabilities:{},chainIds:[m(s),...i.chains.filter(d=>d.id!==s).map(d=>m(d.id))]}]});return{accounts:(await n.request({method:"eth_accounts"})).map(d=>w.accounts.find(P=>P.address===d)??{address:d}).map(d=>({address:l(d.address),capabilities:d.capabilities??{}})),currentChainId:Number(w.chainIds[0])}})();return o||(o=this.onAccountsChanged.bind(this),n.on("accountsChanged",o)),c||(c=this.onChainChanged.bind(this),n.on("chainChanged",c)),a||(a=this.onDisconnect.bind(this),n.on("disconnect",a)),e&&f!==e&&(f=(await this.switchChain({chainId:e}).catch(g=>{if(g.code===y.code)throw g;return{id:f}}))?.id??f),{accounts:t?u:u.map(w=>w.address),chainId:f}}catch(n){throw/(user closed modal|accounts received is empty|user denied account|request rejected)/i.test(n.message)?new y(n):n}},async disconnect(){const e=await this.getProvider();o&&(e.removeListener("accountsChanged",o),o=void 0),c&&(e.removeListener("chainChanged",c),c=void 0),a&&(e.removeListener("disconnect",a),a=void 0),e.disconnect()},async getAccounts(){return(await(await this.getProvider()).request({method:"eth_accounts"})).map(t=>l(t))},async getChainId(){const t=await(await this.getProvider()).request({method:"eth_chainId"});return Number(t)},async getProvider(){if(!p){const e=typeof h.preference=="string"?{options:h.preference}:{...h.preference,options:h.preference?.options??"all"},{createBaseAccountSDK:t}=await C(async()=>{const{createBaseAccountSDK:n}=await import("./connectors_false-DvV4NUYx.js");return{createBaseAccountSDK:n}},[]);p=t({...h,appChainIds:i.chains.map(n=>n.id),preference:e}).getProvider()}return p},async isAuthorized(){try{return!!(await this.getAccounts()).length}catch{return!1}},async switchChain({addEthereumChainParameter:e,chainId:t}){const r=i.chains.find(s=>s.id===t);if(!r)throw new _(new A);const n=await this.getProvider();try{return await n.request({method:"wallet_switchEthereumChain",params:[{chainId:m(r.id)}]}),r}catch(s){if(s.code===4902)try{let u;e?.blockExplorerUrls?u=e.blockExplorerUrls:u=r.blockExplorers?.default.url?[r.blockExplorers?.default.url]:[];let f;e?.rpcUrls?.length?f=e.rpcUrls:f=[r.rpcUrls.default?.http[0]??""];const w={blockExplorerUrls:u,chainId:m(t),chainName:e?.chainName??r.name,iconUrls:e?.iconUrls,nativeCurrency:e?.nativeCurrency??r.nativeCurrency,rpcUrls:f};return await n.request({method:"wallet_addEthereumChain",params:[w]}),r}catch(u){throw new y(u)}throw new _(s)}},onAccountsChanged(e){e.length===0?this.onDisconnect():i.emitter.emit("change",{accounts:e.map(t=>l(t))})},onChainChanged(e){const t=Number(e);i.emitter.emit("change",{chainId:t})},async onDisconnect(e){i.emitter.emit("disconnect");const t=await this.getProvider();o&&(t.removeListener("accountsChanged",o),o=void 0),c&&(t.removeListener("chainChanged",c),c=void 0),a&&(t.removeListener("disconnect",a),a=void 0)}}))}I.type="safe";function I(h={}){const{shimDisconnect:p=!1}=h;let o,c;return b(a=>({id:"safe",name:"Safe",type:I.type,async connect({withCapabilities:i}={}){const e=await this.getProvider();if(!e)throw new v;const t=await this.getAccounts(),r=await this.getChainId();return c||(c=this.onDisconnect.bind(this),e.on("disconnect",c)),p&&await a.storage?.removeItem("safe.disconnected"),{accounts:i?t.map(n=>({address:n,capabilities:{}})):t,chainId:r}},async disconnect(){const i=await this.getProvider();if(!i)throw new v;c&&(i.removeListener("disconnect",c),c=void 0),p&&await a.storage?.setItem("safe.disconnected",!0)},async getAccounts(){const i=await this.getProvider();if(!i)throw new v;return(await i.request({method:"eth_accounts"})).map(l)},async getProvider(){if(typeof window<"u"&&window?.parent!==window){if(!o){const{default:e}=await C(async()=>{const{default:s}=await import("./index-BoVrSYUP.js");return{default:s}},__vite__mapDeps([0,1,2,3,4])),t=new e(h),r=await D(()=>t.safe.getInfo(),{timeout:h.unstable_getInfoTimeout??10});if(!r)throw new Error("Could not load Safe information");const n=await(async()=>{const s=await C(()=>import("./index-DA3ElXG0.js").then(u=>u.i),__vite__mapDeps([5,2,3,1]));return typeof s.SafeAppProvider!="function"&&typeof s.default.SafeAppProvider=="function"?s.default.SafeAppProvider:s.SafeAppProvider})();o=new n(r,t)}return o}},async getChainId(){const i=await this.getProvider();if(!i)throw new v;return Number(i.chainId)},async isAuthorized(){try{return p&&await a.storage?.getItem("safe.disconnected")?!1:!!(await this.getAccounts()).length}catch{return!1}},onAccountsChanged(){},onChainChanged(){},onDisconnect(){a.emitter.emit("disconnect")}}))}export{q as baseAccount,k as injected,I as safe};
